C51 COMPILER V9.01   SSI2_INIT                                                             02/22/2021 14:14:38 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE SSI2_INIT
OBJECT MODULE PLACED IN .\Objects\SSI2_Init.obj
COMPILER INVOKED BY: D:\Program Files\keil 4\C51\BIN\C51.EXE c\SSI2_Init.c LARGE OPTIMIZE(7,SPEED) BROWSE DEBUG OBJECTEX
                    -TEND PRINT(.\Listings\SSI2_Init.lst) OBJECT(.\Objects\SSI2_Init.obj)

line level    source

   1          #include "H/Function_Init.H"
   2          //#include"H/OledFont.h"
   3          
   4          
   5          uint temp_vH;           //ⲿ¶ȱ
   6          uint temp_vH1;          //ڴ¶ȴ60ʱ,ϴƱ60
   7          uint temp_vL;           //ⲿ¶ȱ
   8          
   9          uint humid_vH;          //ⲿʪȱ
  10          uint humid_vL;          //ⲿʪȱ
  11          uchar temp_H;           //¶ֵ8λ
  12          uchar temp_L;           //¶ֵ8λ
  13          
  14          uchar humid_z;          //ʪֵ
  15          //float temp_vHxs;      //ڴС¶мֵ
  16          
  17          
  18          bit TWI1Flag = 0;         //TWI1жϱ־λ
  19          bit TWI2Flag = 0;         //TWI2жϱ־λ
  20          bit test_bit=0;                   //һSHT20ʪݱ־λ
  21          
  22          bit fs_temp;                    //Ϊı
  23          
  24          
  25          char temp_shiwei;       //¶ʮλ
  26          char temp_gewei;        //¶ʮλλ
  27          char temp_xiaoshu; //¶ʮλСλ
  28          
  29          char    humid_shiwei;   //ʪʮλ
  30          char    humid_gewei;            //ʪȸλ
  31          
  32          
  33          /*****************************************************
  34          *ƣvoid Write_IIC_Data(unsigned char IIC_Data)
  35          *ܣI2COLED  
  36          *ڲvoid
  37          *ڲvoid
  38          *****************************************************/
  39          
  40          void Write_IIC_Data(uchar IIC_Data)       //д
  41           {
  42   1              US1CON1 |= 0x20;    //ʼ,ͬʱж
  43   1              while(!TWI1Flag);       //ȴTWIж
  44   1              TWI1Flag = 0;           //TWI1жϱ־λ0
  45   1              US1CON3 = 0x78;     //͵ַд ݻĴֽ             λΪ0д
  46   1              while(!TWI1Flag);       //ȴTWIж,Ҳж
  47   1          TWI1Flag = 0;               //TWI1жϱ־λ0
  48   1              US1CON3 = 0x40;     //ʾ淢д
  49   1              while(!TWI1Flag);       //ȴTWIж
  50   1          TWI1Flag = 0;               //TWI1жϱ־λ0
  51   1              US1CON3 = IIC_Data;     //,Ҳж
  52   1          while(!TWI1Flag);   //ȴTWIж
  53   1          TWI1Flag = 0;               //TWI2жϱ־λ0
  54   1              Delay(100);                     //ʱ
C51 COMPILER V9.01   SSI2_INIT                                                             02/22/2021 14:14:38 PAGE 2   

  55   1              US1CON1 |= 0x10;        //ֹͣ   Ҳж鲻*/   
  56   1              Delay(100);                     //ʱ
  57   1              TWI1Flag = 0;           //TWI1жϱ־λ0  ***********һжϱ־,ֹͣҲж,ֹһ֡
             -(ַ)
  58   1      }
  59          /*****************************************************
  60          *ƣWrite_IIC_Command(unsigned char IIC_Command)
  61          *ܣI2COLED  ָ
  62          *ڲvoid
  63          *ڲvoid
  64          *****************************************************/
  65           
  66          void  Write_IIC_Command(uchar IIC_Command)        //дָ
  67           {
  68   1              US1CON1 |= 0x20;    //ʼ,ͬʱж
  69   1              while(!TWI1Flag);       //ȴTWIж
  70   1          TWI1Flag = 0;               //TWI1жϱ־λ0
  71   1              US1CON3 = 0x78;     //͵ַд ݻĴֽ             λΪ0д
  72   1              while(!TWI1Flag);       //ȴTWIж,Ҳж
  73   1          TWI1Flag = 0;               //TWI1жϱ־λ0
  74   1              US1CON3 = 0x00;     //ʾ淢д
  75   1              while(!TWI1Flag);       //ȴTWIж
  76   1          TWI1Flag = 0;               //TWI1жϱ־λ0
  77   1              US1CON3 = IIC_Command;  //,Ҳж
  78   1          while(!TWI1Flag);   //ȴTWIж
  79   1          TWI1Flag = 0;               //TWI1жϱ־λ0
  80   1              Delay(100);                     //ʱ
  81   1              US1CON1 |= 0x10;        //ֹͣ 
  82   1              Delay(100);                     //ʱ
  83   1              TWI1Flag = 0;           //TWI1жϱ־λ0  ***********һжϱ־,ֹͣҲж,ֹһ֡
             -(ַ)
  84   1      
  85   1      }                         //*/
  86          
  87          
  88          
  89          
  90          
  91          
  92          /*****************************************************
  93          *ƣvoid SSI2_Test(void)
  94          *ܣSSI2             SHT30ʪָ
  95          *ڲvoid
  96          *ڲvoid
  97          *****************************************************/
  98          
  99          void SSI2_Test(void)
 100           {
 101   1              US2CON1 |= 0x20;    //ʼ,ͬʱж
 102   1              while(!TWI2Flag);       //ȴTWIж
 103   1          TWI2Flag = 0;               //TWI2жϱ־λ0
 104   1              US2CON3 = 0x88;     //͵ַд ݻĴֽ             λΪ0д
 105   1              while(!TWI2Flag);       //ȴTWIж,Ҳж
 106   1          TWI2Flag = 0;               //TWI2жϱ־λ0
 107   1              US2CON3 = 0x2C;     //,Ҳж     
 108   1              while(!TWI2Flag);       //ȴTWIж
 109   1          TWI2Flag = 0;               //TWI2жϱ־λ0
 110   1              US2CON3 = 0x06;     //,Ҳж
 111   1          while(!TWI2Flag);   //ȴTWIж
 112   1          TWI2Flag = 0;               //TWI2жϱ־λ0
 113   1              Delay(100);                     //ʱ
 114   1              US2CON1 |= 0x10;        //ֹͣ   
C51 COMPILER V9.01   SSI2_INIT                                                             02/22/2021 14:14:38 PAGE 3   

 115   1              Delay(100);                     //ʱ
 116   1              TWI2Flag = 0;           //TWI2жϱ־λ0     
 117   1      }                                               //*/
 118          /*****************************************************
 119          *ƣvoid SSI2_R(void)
 120          *ܣSHT30
 121          *ڲvoid
 122          *ڲvoid
 123          *****************************************************/
 124          
 125          void SSI2_R(void)
 126           {
 127   1              US2CON1 |= 0x20;    //ʼ,ͬʱж
 128   1              while(!TWI2Flag);       //ȴTWIж
 129   1          TWI2Flag = 0;               //TWI2жϱ־λ0
 130   1              US2CON3 = 0x89;     //͵ַ          λΪ1Ƕ
 131   1              while(!TWI2Flag);       //ȴTWIж,Ҳж
 132   1              TWI2Flag = 0;           //TWI2жϱ־λ0
 133   1              US2CON0 |= 0x08;        //ʹӦλ
 134   1      //ȡ¶ȵһֽ
 135   1              while(!TWI2Flag);       //ȴTWIж,8λҲж
 136   1      
 137   1              TWI2Flag = 0;           //TWI2жϱ־λ0
 138   1              temp_vH = US2CON3;      //ȡյֵ,¶Ⱥʪ
 139   1      //ȡ¶ȵڶֽ
 140   1              while(!TWI2Flag);       //ȴTWIж,8λҲж
 141   1              TWI2Flag = 0;           //TWI2жϱ־λ0
 142   1              temp_vL = US2CON3;      //ȡյֵ,¶Ⱥʪ
 143   1      //ȡ¶Уֵ
 144   1              while(!TWI2Flag);       //ȴTWIж,8λҲж
 145   1              TWI2Flag = 0;           //TWI2жϱ־λ0
 146   1      //      temp_v  = US2CON3;      //ȡյֵ,¶Ⱥʪ
 147   1      
 148   1      //ȡʪȵһֽ
 149   1              while(!TWI2Flag);       //ȴTWIж,8λҲж
 150   1              TWI2Flag = 0;           //TWI2жϱ־λ0
 151   1              humid_vH        = US2CON3;      //ȡյֵ,¶Ⱥʪ
 152   1      //ȡʪȵڶֽ
 153   1              while(!TWI2Flag);               //ȴTWIж,8λҲж
 154   1              TWI2Flag = 0;                   //TWI2жϱ־λ0
 155   1              humid_vL        = US2CON3;      //ȡյֵ,¶Ⱥʪ
 156   1              US2CON0 &= 0xF7;                //رӦλ   һֹֽͣ
 157   1      //ȡʪУֵ
 158   1              while(!TWI2Flag);       //ȴTWIж,8λҲж
 159   1              TWI2Flag = 0;           //TWI2жϱ־λ0
 160   1          TWI2Flag = 0;               //TWI2жϱ־λ0
 161   1              Delay(100);                     //ʱ
 162   1              US2CON1 |= 0x10;        //ֹͣ  */   
 163   1              Delay(100);     
 164   1                
 165   1              temp_vH<<=8;                                            //¶ȵĸ߰λ,ưλ                                   
 166   1              temp_vH= temp_vH+temp_vL;                       //ʡԵͰλ,ʡԵͰλע͵
 167   1      
 168   1      
 169   1      //      temp_vH=26850;                                          //¶
 170   1      
 171   1              if(temp_vH>16851)       //*******************¶ȷƶ˼ʾ*************************
 172   1              { 
 173   2                      fs_temp=0;                                                                              //帺־
 174   2              //****************Ϊ¶*****************************
 175   2                      temp_vH = ((temp_vH/65535.0*175)-45)*10;                //ҪӸ
 176   2                      if(temp_vH>600){temp_vH1=600;}                                  //¶ȴ60,OLEDʾ,ƶݱ60,ֹ,ԭΪƶ
C51 COMPILER V9.01   SSI2_INIT                                                             02/22/2021 14:14:38 PAGE 4   

             -֧60
 177   2                      else{temp_vH1=temp_vH;}                                                 //¶С60ʾͬ,ʾֻһʾ.
 178   2                      temp_H  = (temp_vH1/256);                                               //õĸ߰λ
 179   2                      temp_L  = (temp_vH1%256);                                               //õĵͰλ   */
 180   2      
 181   2                      temp_shiwei      = temp_vH%1000/100;                            //ʮλ ,ʾ        
 182   2                      temp_gewei       = temp_vH%100/10;                                      //λ ,ʾ
 183   2                      temp_xiaoshu = temp_vH%10;                                              //Сλ,ʾ
 184   2              } 
 185   1              else            //*************¶ȷƶ˼ʾ***********************                                                         /65535
 186   1              {
 187   2                      fs_temp=1;                                                              //־1
 188   2                      temp_vH = (temp_vH/65535.0*175)*10;             //ҪӸ
 189   2                      temp_H  = 0xff;                                                 //õĸ߰λ
 190   2                      temp_L  =0xff-(449-temp_vH);                    //õĵͰλ   */
 191   2      
 192   2                      temp_shiwei      = (256-temp_L)/100;                            //ʮλ ,ʾ        
 193   2                      temp_gewei       = (256-temp_L)%100/10;                         //λ ,ʾ
 194   2                      temp_xiaoshu = (256-temp_L)%10;                                 //Сλ,ʾ
 195   2              
 196   2              }
 197   1      
 198   1      
 199   1      //      temp_shiwei      = temp_vH%1000/100;                    //ʮλ        
 200   1      //      temp_gewei       = temp_vH%100/10;                              //λ
 201   1      //      temp_xiaoshu = temp_vH%10;                                      //Сλ
 202   1      
 203   1      
 204   1      //ʪ
 205   1              humid_vH<<=8;
 206   1              humid_vH  = humid_vH+humid_vL;
 207   1              humid_vH  = humid_vH/655.35;
 208   1              humid_z   = humid_vH;  
 209   1      
 210   1              humid_shiwei     = humid_vH/10;                 //ʮλ
 211   1              humid_gewei      = humid_vH%10;;                //λ
 212   1      
 213   1      }
 214          
 215          
 216          
 217          /*****************************************************
 218          *ƣvoid TWI2_Init(void)
 219          *ܣTWI1 TWI2   ʼ
 220          *ڲvoid
 221          *ڲvoid
 222          *****************************************************/
 223          void TWI2_Init(void)
 224          {
 225   1              OTCON  |= 0x80;         //ѡTWI1ģʽ
 226   1              TMCON  |= 0x80;         //ѡһΪTWI2ͨģʽ
 227   1              US1CON0 = 0x80;         //ʹTWI ʹӦ־λ
 228   1              US1CON1 = 0x03;         //---- xxxx  xΪʱ  0x05Ϊ1M       03Ϊ250K
 229   1              US2CON0 = 0x80;         //ʹTWI ʹӦ־λ
 230   1              US2CON1 = 0x03;         //---- xxxx  xΪʱ  0x05Ϊ1M       03Ϊ250K
 231   1              
 232   1              IE2 |= 0x02;            //һUSCI2жж
 233   1              IE2 |= 0x01;            //USCI1жҲж
 234   1              EA = 1;                         //ж                    //ж
 235   1      } 
 236          void TWI1_Int() interrupt 15     //TWI1жϺ
 237          {
C51 COMPILER V9.01   SSI2_INIT                                                             02/22/2021 14:14:38 PAGE 5   

 238   1              if(US1CON0&0x40)                //TWIж
 239   1              {
 240   2                      US1CON0 &= 0xbf;        //ж
 241   2                      TWI1Flag = 1;           //TWI2жϱ־λ1
 242   2              }       
 243   1      }
 244           
 245          
 246           //жΪ1.ź2.ַ֡3.ջ֡
 247          void TWI2_Int() interrupt 16     //TWI2жϺ
 248          {
 249   1              if(US2CON0&0x40)                //TWIж
 250   1              {
 251   2                      US2CON0 &= 0xbf;        //ж
 252   2                      TWI2Flag = 1;           //TWI2жϱ־λ1
 253   2              }       
 254   1      }       


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    814    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     18    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      4    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
