C51 COMPILER V9.01   MCU_API                                                               01/30/2021 09:17:26 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE MCU_API
OBJECT MODULE PLACED IN .\Objects\mcu_api.obj
COMPILER INVOKED BY: D:\Program Files\keil 4\C51\BIN\C51.EXE MCU_SDK\mcu_api.c BROWSE DEBUG OBJECTEXTEND PRINT(.\Listing
                    -s\mcu_api.lst) OBJECT(.\Objects\mcu_api.obj)

line level    source

   1          /**********************************Copyright (c)**********************************
   2          **                       ç‰ˆæƒæ‰€æœ‰ (C), 2015-2020, æ¶‚é¸¦ç§‘æŠ€
   3          **
   4          **                             http://www.tuya.com
   5          **
   6          *********************************************************************************/
   7          /**
   8           * @file    mcu_api.c
   9           * @author  æ¶‚é¸¦ç»¼åˆåè®®å¼€å‘ç»„
  10           * @version v2.5.6
  11           * @date    2020.12.16
  12           * @brief   ç”¨æˆ·éœ€è¦ä¸»åŠ¨è°ƒç”¨çš„å‡½æ•°éƒ½åœ¨è¯¥æ–‡ä»¶å†…
  13           */
  14          
  15          /****************************** å…è´£å£°æ˜ ï¼ï¼ï¼ *******************************
  16          ç”±äºMCUç±»å‹å’Œç¼–è¯‘ç¯å¢ƒå¤šç§å¤šæ ·ï¼Œæ‰€ä»¥æ­¤ä»£ç ä»…ä¾›å‚è€ƒï¼Œç”¨æˆ·è¯·è‡ªè¡ŒæŠŠæ§æœ€ç»ˆä»£ç
             - è´¨é‡ï¼Œ
  17          æ¶‚é¸¦ä¸å¯¹MCUåŠŸèƒ½ç»“æœè´Ÿè´£ã€‚
  18          ******************************************************************************/
  19          
  20          #define MCU_API_GLOBAL
  21          
  22          #include "wifi.h"
  23          
  24          /**
  25           * @brief  hexè½¬bcd
  26           * @param[in] {Value_H} é«˜å­—èŠ‚
  27           * @param[in] {Value_L} ä½å­—èŠ‚
  28           * @return è½¬æ¢å®Œæˆåæ•°æ®
  29           */
  30          unsigned char hex_to_bcd(unsigned char Value_H,unsigned char Value_L)
  31          {
  32   1          unsigned char bcd_value;
  33   1          
  34   1          if((Value_H >= '0') && (Value_H <= '9'))
  35   1              Value_H -= '0';
  36   1          else if((Value_H >= 'A') && (Value_H <= 'F'))
  37   1              Value_H = Value_H - 'A' + 10;
  38   1          else if((Value_H >= 'a') && (Value_H <= 'f'))
  39   1              Value_H = Value_H - 'a' + 10;
  40   1           
  41   1          bcd_value = Value_H & 0x0f;
  42   1          
  43   1          bcd_value <<= 4;
  44   1          if((Value_L >= '0') && (Value_L <= '9'))
  45   1              Value_L -= '0';
  46   1          else if((Value_L >= 'A') && (Value_L <= 'F'))
  47   1              Value_L = Value_L - 'a' + 10;
  48   1          else if((Value_L >= 'a') && (Value_L <= 'f'))
  49   1              Value_L = Value_L - 'a' + 10;
  50   1          
  51   1          bcd_value |= Value_L & 0x0f;
  52   1      
  53   1          return bcd_value;
C51 COMPILER V9.01   MCU_API                                                               01/30/2021 09:17:26 PAGE 2   

  54   1      }
  55          
  56          /**
  57           * @brief  æ±‚å­—ç¬¦ä¸²é•¿åº¦
  58           * @param[in] {str} å­—ç¬¦ä¸²åœ°å€
  59           * @return æ•°æ®é•¿åº¦
  60           */
  61          unsigned long my_strlen(unsigned char *str)  
  62          {
  63   1          unsigned long len = 0;
  64   1          if(str == NULL) { 
  65   2              return 0;
  66   2          }
  67   1          
  68   1          for(len = 0; *str ++ != '\0'; ) {
  69   2              len ++;
  70   2          }
  71   1          
  72   1          return len;
  73   1      }
  74          
  75          /**
  76           * @brief  æŠŠsrcæ‰€æŒ‡å†…å­˜åŒºåŸŸçš„å‰countä¸ªå­—èŠ‚è®¾ç½®æˆå­—ç¬¦c
  77           * @param[out] {src} å¾…è®¾ç½®çš„å†…å­˜é¦–åœ°å€
  78           * @param[in] {ch} è®¾ç½®çš„å­—ç¬¦
  79           * @param[in] {count} è®¾ç½®çš„å†…å­˜é•¿åº¦
  80           * @return å¾…è®¾ç½®çš„å†…å­˜é¦–åœ°å€
  81           */
  82          void *my_memset(void *src,unsigned char ch,unsigned short count)
  83          {
  84   1          unsigned char *tmp = (unsigned char *)src;
  85   1          
  86   1          if(src == NULL) {
  87   2              return NULL;
  88   2          }
  89   1          
  90   1          while(count --) {
  91   2              *tmp ++ = ch;
  92   2          }
  93   1          
  94   1          return src;
  95   1      }
  96          
  97          /**
  98           * @brief  å†…å­˜æ‹·è´
  99           * @param[out] {dest} ç›®æ ‡åœ°å€
 100           * @param[in] {src} æºåœ°å€
 101           * @param[in] {count} æ‹·è´æ•°æ®ä¸ªæ•°
 102           * @return æ•°æ®å¤„ç†å®Œåçš„æºåœ°å€
 103           */
 104          void *my_memcpy(void *dest, const void *src, unsigned short count)  
 105          {  
 106   1          unsigned char *pdest = (unsigned char *)dest;  
 107   1          const unsigned char *psrc  = (const unsigned char *)src;  
 108   1          unsigned short i;
 109   1          
 110   1          if(dest == NULL || src == NULL) { 
 111   2              return NULL;
 112   2          }
 113   1          
 114   1          if((pdest <= psrc) || (pdest > psrc + count)) {  
 115   2              for(i = 0; i < count; i ++) {  
C51 COMPILER V9.01   MCU_API                                                               01/30/2021 09:17:26 PAGE 3   

 116   3                  pdest[i] = psrc[i];  
 117   3              }  
 118   2          }else {
 119   2              for(i = count; i > 0; i --) {  
 120   3                  pdest[i - 1] = psrc[i - 1];  
 121   3              }  
 122   2          }  
 123   1          
 124   1          return dest;  
 125   1      }
 126          
 127          /**
 128           * @brief  å­—ç¬¦ä¸²æ‹·è´
 129           * @param[in] {dest} ç›®æ ‡åœ°å€
 130           * @param[in] {src} æºåœ°å€
 131           * @return æ•°æ®å¤„ç†å®Œåçš„æºåœ°å€
 132           */
 133          char *my_strcpy(char *dest, const char *src)  
 134          {
 135   1          if((NULL == dest) || (NULL == src)) {
 136   2              return NULL;
 137   2          }
 138   1          
 139   1          char *p = dest;
*** ERROR C141 IN LINE 139 OF MCU_SDK\MCU_API.C: syntax error near 'char'
*** ERROR C202 IN LINE 139 OF MCU_SDK\MCU_API.C: 'p': undefined identifier
 140   1          while(*src!='\0') {
 141   2              *dest++ = *src++;
 142   2          }
 143   1          *dest = '\0';
 144   1          return p;
*** ERROR C202 IN LINE 144 OF MCU_SDK\MCU_API.C: 'p': undefined identifier
 145   1      }
 146          
 147          /**
 148           * @brief  å­—ç¬¦ä¸²æ¯”è¾ƒ
 149           * @param[in] {s1} å­—ç¬¦ä¸² 1
 150           * @param[in] {s2} å­—ç¬¦ä¸² 2
 151           * @return å¤§å°æ¯”è¾ƒå€¼
 152           * -         0:s1=s2
 153           * -         <0:s1<s2
 154           * -         >0:s1>s2
 155           */
 156          int my_strcmp(char *s1 , char *s2)
 157          {
 158   1          while( *s1 && *s2 && *s1 == *s2 ) {
 159   2              s1++;
 160   2              s2++;
 161   2          }
 162   1          return *s1 - *s2;
 163   1      }
 164          
 165          /**
 166           * @brief  å°†intç±»å‹æ‹†åˆ†å››ä¸ªå­—èŠ‚
 167           * @param[in] {number} 4å­—èŠ‚åŸæ•°æ®
 168           * @param[out] {value} å¤„ç†å®Œæˆå4å­—èŠ‚æ•°æ®
 169           * @return Null
 170           */
 171          void int_to_byte(unsigned long number,unsigned char value[4])
 172          {
 173   1          value[0] = number >> 24;
 174   1          value[1] = number >> 16;
C51 COMPILER V9.01   MCU_API                                                               01/30/2021 09:17:26 PAGE 4   

 175   1          value[2] = number >> 8;
 176   1          value[3] = number & 0xff;
 177   1      }
 178          
 179          /**
 180           * @brief  å°†4å­—èŠ‚åˆå¹¶ä¸º1ä¸ª32bitå˜é‡
 181           * @param[in] {value} 4å­—èŠ‚æ•°ç»„
 182           * @return åˆå¹¶å®Œæˆåçš„32bitå˜é‡
 183           */
 184          unsigned long byte_to_int(const unsigned char value[4])
 185          {
 186   1          unsigned long nubmer = 0;
 187   1      
 188   1          nubmer = (unsigned long)value[0];
 189   1          nubmer <<= 8;
 190   1          nubmer |= (unsigned long)value[1];
 191   1          nubmer <<= 8;
 192   1          nubmer |= (unsigned long)value[2];
 193   1          nubmer <<= 8;
 194   1          nubmer |= (unsigned long)value[3];
 195   1          
 196   1          return nubmer;
 197   1      }
 198          
 199          /**
 200           * @brief  rawå‹dpæ•°æ®ä¸Šä¼ 
 201           * @param[in] {dpid} dpidå·
 202           * @param[in] {value} å½“å‰dpå€¼æŒ‡é’ˆ
 203           * @param[in] {len} æ•°æ®é•¿åº¦
 204           * @return Null
 205           * @note   Null
 206           */
 207          unsigned char mcu_dp_raw_update(unsigned char dpid,const unsigned char value[],unsigned short len)
 208          {
 209   1          unsigned short send_len = 0;
 210   1          
 211   1          if(stop_update_flag == ENABLE)
 212   1              return SUCCESS;
 213   1          //
 214   1          send_len = set_wifi_uart_byte(send_len,dpid);
 215   1          send_len = set_wifi_uart_byte(send_len,DP_TYPE_RAW);
 216   1          //
 217   1          send_len = set_wifi_uart_byte(send_len,len / 0x100);
 218   1          send_len = set_wifi_uart_byte(send_len,len % 0x100);
 219   1          //
 220   1          send_len = set_wifi_uart_buffer(send_len,(unsigned char *)value,len);
 221   1          
 222   1          wifi_uart_write_frame(STATE_UPLOAD_CMD,MCU_TX_VER,send_len);
 223   1          
 224   1          return SUCCESS;
 225   1      }
 226          
 227          /**
 228           * @brief  boolå‹dpæ•°æ®ä¸Šä¼ 
 229           * @param[in] {dpid} dpidå·
 230           * @param[in] {value} å½“å‰dpå€¼
 231           * @return Null
 232           * @note   Null
 233           */
 234          unsigned char mcu_dp_bool_update(unsigned char dpid,unsigned char value)
 235          {
 236   1          unsigned short send_len = 0;
C51 COMPILER V9.01   MCU_API                                                               01/30/2021 09:17:26 PAGE 5   

 237   1          
 238   1          if(stop_update_flag == ENABLE)
 239   1              return SUCCESS;
 240   1          
 241   1          send_len = set_wifi_uart_byte(send_len,dpid);
 242   1          send_len = set_wifi_uart_byte(send_len,DP_TYPE_BOOL);
 243   1          //
 244   1          send_len = set_wifi_uart_byte(send_len,0);
 245   1          send_len = set_wifi_uart_byte(send_len,1);
 246   1          //
 247   1          if(value == FALSE) {
 248   2              send_len = set_wifi_uart_byte(send_len,FALSE);
 249   2          }else {
 250   2              send_len = set_wifi_uart_byte(send_len,1);
 251   2          }
 252   1          
 253   1          wifi_uart_write_frame(STATE_UPLOAD_CMD, MCU_TX_VER, send_len);
 254   1          
 255   1          return SUCCESS;
 256   1      }
 257          
 258          /**
 259           * @brief  valueå‹dpæ•°æ®ä¸Šä¼ 
 260           * @param[in] {dpid} dpidå·
 261           * @param[in] {value} å½“å‰dpå€¼
 262           * @return Null
 263           * @note   Null
 264           */
 265          unsigned char mcu_dp_value_update(unsigned char dpid,unsigned long value)
 266          {
 267   1          unsigned short send_len = 0;
 268   1          
 269   1          if(stop_update_flag == ENABLE)
 270   1              return SUCCESS;
 271   1          
 272   1          send_len = set_wifi_uart_byte(send_len,dpid);
 273   1          send_len = set_wifi_uart_byte(send_len,DP_TYPE_VALUE);
 274   1          //
 275   1          send_len = set_wifi_uart_byte(send_len,0);
 276   1          send_len = set_wifi_uart_byte(send_len,4);
 277   1          //
 278   1          send_len = set_wifi_uart_byte(send_len,value >> 24);
 279   1          send_len = set_wifi_uart_byte(send_len,value >> 16);
 280   1          send_len = set_wifi_uart_byte(send_len,value >> 8);
 281   1          send_len = set_wifi_uart_byte(send_len,value & 0xff);
 282   1          
 283   1          wifi_uart_write_frame(STATE_UPLOAD_CMD,MCU_TX_VER,send_len);
 284   1          
 285   1          return SUCCESS;
 286   1      }
 287          
 288          /**
 289           * @brief  stringå‹dpæ•°æ®ä¸Šä¼ 
 290           * @param[in] {dpid} dpidå·
 291           * @param[in] {value} å½“å‰dpå€¼æŒ‡é’ˆ
 292           * @param[in] {len} æ•°æ®é•¿åº¦
 293           * @return Null
 294           * @note   Null
 295           */
 296          unsigned char mcu_dp_string_update(unsigned char dpid,const unsigned char value[],unsigned short len)
 297          {
 298   1          unsigned short send_len = 0;
C51 COMPILER V9.01   MCU_API                                                               01/30/2021 09:17:26 PAGE 6   

 299   1          
 300   1          if(stop_update_flag == ENABLE)
 301   1              return SUCCESS;
 302   1          //
 303   1          send_len = set_wifi_uart_byte(send_len,dpid);
 304   1          send_len = set_wifi_uart_byte(send_len,DP_TYPE_STRING);
 305   1          //
 306   1          send_len = set_wifi_uart_byte(send_len,len / 0x100);
 307   1          send_len = set_wifi_uart_byte(send_len,len % 0x100);
 308   1          //
 309   1          send_len = set_wifi_uart_buffer(send_len,(unsigned char *)value,len);
 310   1          
 311   1          wifi_uart_write_frame(STATE_UPLOAD_CMD,MCU_TX_VER,send_len);
 312   1          
 313   1          return SUCCESS;
 314   1      }
 315          
 316          /**
 317           * @brief  enumå‹dpæ•°æ®ä¸Šä¼ 
 318           * @param[in] {dpid} dpidå·
 319           * @param[in] {value} å½“å‰dpå€¼
 320           * @return Null
 321           * @note   Null
 322           */
 323          unsigned char mcu_dp_enum_update(unsigned char dpid,unsigned char value)
 324          {
 325   1          unsigned short send_len = 0;
 326   1          
 327   1          if(stop_update_flag == ENABLE)
 328   1              return SUCCESS;
 329   1          
 330   1          send_len = set_wifi_uart_byte(send_len,dpid);
 331   1          send_len = set_wifi_uart_byte(send_len,DP_TYPE_ENUM);
 332   1          //
 333   1          send_len = set_wifi_uart_byte(send_len,0);
 334   1          send_len = set_wifi_uart_byte(send_len,1);
 335   1          //
 336   1          send_len = set_wifi_uart_byte(send_len,value);
 337   1          
 338   1          wifi_uart_write_frame(STATE_UPLOAD_CMD,MCU_TX_VER,send_len);
 339   1          
 340   1          return SUCCESS;
 341   1      }
 342          
 343          /**
 344           * @brief  faultå‹dpæ•°æ®ä¸Šä¼ 
 345           * @param[in] {dpid} dpidå·
 346           * @param[in] {value} å½“å‰dpå€¼
 347           * @return Null
 348           * @note   Null
 349           */
 350          unsigned char mcu_dp_fault_update(unsigned char dpid,unsigned long value)
 351          {
 352   1          unsigned short send_len = 0;
 353   1           
 354   1          if(stop_update_flag == ENABLE)
 355   1              return SUCCESS;
 356   1          
 357   1          send_len = set_wifi_uart_byte(send_len,dpid);
 358   1          send_len = set_wifi_uart_byte(send_len,DP_TYPE_BITMAP);
 359   1          //
 360   1          send_len = set_wifi_uart_byte(send_len,0);
C51 COMPILER V9.01   MCU_API                                                               01/30/2021 09:17:26 PAGE 7   

 361   1          
 362   1          if((value | 0xff) == 0xff) {
 363   2              send_len = set_wifi_uart_byte(send_len,1);
 364   2              send_len = set_wifi_uart_byte(send_len,value);
 365   2          }else if((value | 0xffff) == 0xffff) {
 366   2              send_len = set_wifi_uart_byte(send_len,2);
 367   2              send_len = set_wifi_uart_byte(send_len,value >> 8);
 368   2              send_len = set_wifi_uart_byte(send_len,value & 0xff);
 369   2          }else {
 370   2              send_len = set_wifi_uart_byte(send_len,4);
 371   2              send_len = set_wifi_uart_byte(send_len,value >> 24);
 372   2              send_len = set_wifi_uart_byte(send_len,value >> 16);
 373   2              send_len = set_wifi_uart_byte(send_len,value >> 8);
 374   2              send_len = set_wifi_uart_byte(send_len,value & 0xff);
 375   2          }    
 376   1          
 377   1          wifi_uart_write_frame(STATE_UPLOAD_CMD, MCU_TX_VER, send_len);
 378   1      
 379   1          return SUCCESS;
 380   1      }
 381          
 382          #ifdef MCU_DP_UPLOAD_SYN
              /**
               * @brief  rawå‹dpæ•°æ®åŒæ­¥ä¸Šä¼ 
               * @param[in] {dpid} dpidå·
               * @param[in] {value} å½“å‰dpå€¼æŒ‡é’ˆ
               * @param[in] {len} æ•°æ®é•¿åº¦
               * @return Null
               * @note   Null
               */
              unsigned char mcu_dp_raw_update_syn(unsigned char dpid,const unsigned char value[],unsigned short len)
              {
                  unsigned short send_len = 0;
                  
                  if(stop_update_flag == ENABLE)
                      return SUCCESS;
                  //
                  send_len = set_wifi_uart_byte(send_len,dpid);
                  send_len = set_wifi_uart_byte(send_len,DP_TYPE_RAW);
                  //
                  send_len = set_wifi_uart_byte(send_len,len / 0x100);
                  send_len = set_wifi_uart_byte(send_len,len % 0x100);
                  //
                  send_len = set_wifi_uart_buffer(send_len,(unsigned char *)value,len);
                  
                  wifi_uart_write_frame(STATE_UPLOAD_SYN_CMD,MCU_TX_VER,send_len);
                  
                  return SUCCESS;
              }
              
              /**
               * @brief  boolå‹dpæ•°æ®åŒæ­¥ä¸Šä¼ 
               * @param[in] {dpid} dpidå·
               * @param[in] {value} å½“å‰dpå€¼æŒ‡é’ˆ
               * @return Null
               * @note   Null
               */
              unsigned char mcu_dp_bool_update_syn(unsigned char dpid,unsigned char value)
              {
                  unsigned short send_len = 0;
                  
                  if(stop_update_flag == ENABLE)
C51 COMPILER V9.01   MCU_API                                                               01/30/2021 09:17:26 PAGE 8   

                      return SUCCESS;
                  
                  send_len = set_wifi_uart_byte(send_len,dpid);
                  send_len = set_wifi_uart_byte(send_len,DP_TYPE_BOOL);
                  //
                  send_len = set_wifi_uart_byte(send_len,0);
                  send_len = set_wifi_uart_byte(send_len,1);
                  //
                  if(value == FALSE) {
                      send_len = set_wifi_uart_byte(send_len,FALSE);
                  }else {
                      send_len = set_wifi_uart_byte(send_len,1);
                  }
                  
                  wifi_uart_write_frame(STATE_UPLOAD_SYN_CMD, MCU_TX_VER, send_len);
                  
                  return SUCCESS;
              }
              
              /**
               * @brief  valueå‹dpæ•°æ®åŒæ­¥ä¸Šä¼ 
               * @param[in] {dpid} dpidå·
               * @param[in] {value} å½“å‰dpå€¼æŒ‡é’ˆ
               * @return Null
               * @note   Null
               */
              unsigned char mcu_dp_value_update_syn(unsigned char dpid,unsigned long value)
              {
                  unsigned short send_len = 0;
                  
                  if(stop_update_flag == ENABLE)
                      return SUCCESS;
                  
                  send_len = set_wifi_uart_byte(send_len,dpid);
                  send_len = set_wifi_uart_byte(send_len,DP_TYPE_VALUE);
                  //
                  send_len = set_wifi_uart_byte(send_len,0);
                  send_len = set_wifi_uart_byte(send_len,4);
                  //
                  send_len = set_wifi_uart_byte(send_len,value >> 24);
                  send_len = set_wifi_uart_byte(send_len,value >> 16);
                  send_len = set_wifi_uart_byte(send_len,value >> 8);
                  send_len = set_wifi_uart_byte(send_len,value & 0xff);
                  
                  wifi_uart_write_frame(STATE_UPLOAD_SYN_CMD, MCU_TX_VER, send_len);
                  
                  return SUCCESS;
              }
              
              /**
               * @brief  stringå‹dpæ•°æ®åŒæ­¥ä¸Šä¼ 
               * @param[in] {dpid} dpidå·
               * @param[in] {value} å½“å‰dpå€¼æŒ‡é’ˆ
               * @param[in] {len} æ•°æ®é•¿åº¦
               * @return Null
               * @note   Null
               */
              unsigned char mcu_dp_string_update_syn(unsigned char dpid,const unsigned char value[],unsigned short len)
              {
                  unsigned short send_len = 0;
                  
                  if(stop_update_flag == ENABLE)
C51 COMPILER V9.01   MCU_API                                                               01/30/2021 09:17:26 PAGE 9   

                      return SUCCESS;
                  //
                  send_len = set_wifi_uart_byte(send_len,dpid);
                  send_len = set_wifi_uart_byte(send_len,DP_TYPE_STRING);
                  //
                  send_len = set_wifi_uart_byte(send_len,len / 0x100);
                  send_len = set_wifi_uart_byte(send_len,len % 0x100);
                  //
                  send_len = set_wifi_uart_buffer(send_len,(unsigned char *)value,len);
                  
                  wifi_uart_write_frame(STATE_UPLOAD_SYN_CMD,MCU_TX_VER,send_len);
                  
                  return SUCCESS;
              }
              
              /**
               * @brief  enumå‹dpæ•°æ®åŒæ­¥ä¸Šä¼ 
               * @param[in] {dpid} dpidå·
               * @param[in] {value} å½“å‰dpå€¼æŒ‡é’ˆ
               * @return Null
               * @note   Null
               */
              unsigned char mcu_dp_enum_update_syn(unsigned char dpid,unsigned char value)
              {
                  unsigned short send_len = 0;
                  
                  if(stop_update_flag == ENABLE)
                      return SUCCESS;
                  
                  send_len = set_wifi_uart_byte(send_len,dpid);
                  send_len = set_wifi_uart_byte(send_len,DP_TYPE_ENUM);
                  //
                  send_len = set_wifi_uart_byte(send_len,0);
                  send_len = set_wifi_uart_byte(send_len,1);
                  
                  send_len = set_wifi_uart_byte(send_len,value);
                  
                  wifi_uart_write_frame(STATE_UPLOAD_SYN_CMD,MCU_TX_VER,send_len);
                  
                  return SUCCESS;
              }
              
              /**
               * @brief  faultå‹dpæ•°æ®åŒæ­¥ä¸Šä¼ 
               * @param[in] {dpid} dpidå·
               * @param[in] {value} å½“å‰dpå€¼æŒ‡é’ˆ
               * @return Null
               * @note   Null
               */
              unsigned char mcu_dp_fault_update_syn(unsigned char dpid,unsigned long value)
              {
                  unsigned short send_len = 0;
                   
                  if(stop_update_flag == ENABLE)
                      return SUCCESS;
                  
                  send_len = set_wifi_uart_byte(send_len,dpid);
                  send_len = set_wifi_uart_byte(send_len,DP_TYPE_BITMAP);
                  //
                  send_len = set_wifi_uart_byte(send_len,0);
                  
                  if((value | 0xff) == 0xff) {
C51 COMPILER V9.01   MCU_API                                                               01/30/2021 09:17:26 PAGE 10  

                      send_len = set_wifi_uart_byte(send_len,1);
                      send_len = set_wifi_uart_byte(send_len,value);
                  }else if((value | 0xffff) == 0xffff) {
                      send_len = set_wifi_uart_byte(send_len,2);
                      send_len = set_wifi_uart_byte(send_len,value >> 8);
                      send_len = set_wifi_uart_byte(send_len,value & 0xff);
                  }else {
                      send_len = set_wifi_uart_byte(send_len,4);
                      send_len = set_wifi_uart_byte(send_len,value >> 24);
                      send_len = set_wifi_uart_byte(send_len,value >> 16);
                      send_len = set_wifi_uart_byte(send_len,value >> 8);
                      send_len = set_wifi_uart_byte(send_len,value & 0xff);
                  }    
                  
                  wifi_uart_write_frame(STATE_UPLOAD_SYN_CMD,MCU_TX_VER,send_len);
              
                  return SUCCESS;
              }
              #endif
 566          
 567          /**
 568           * @brief  mcuè·å–boolå‹ä¸‹å‘dpå€¼
 569           * @param[in] {value} dpæ•°æ®ç¼“å†²åŒºåœ°å€
 570           * @param[in] {len} dpæ•°æ®é•¿åº¦
 571           * @return å½“å‰dpå€¼
 572           * @note   Null
 573           */
 574          unsigned char mcu_get_dp_download_bool(const unsigned char value[],unsigned short len)
 575          {
 576   1          return(value[0]);
 577   1      }
 578          
 579          /**
 580           * @brief  mcuè·å–enumå‹ä¸‹å‘dpå€¼
 581           * @param[in] {value} dpæ•°æ®ç¼“å†²åŒºåœ°å€
 582           * @param[in] {len} dpæ•°æ®é•¿åº¦
 583           * @return å½“å‰dpå€¼
 584           * @note   Null
 585           */
 586          unsigned char mcu_get_dp_download_enum(const unsigned char value[],unsigned short len)
 587          {
 588   1          return(value[0]);
 589   1      }
 590          
 591          /**
 592           * @brief  mcuè·å–valueå‹ä¸‹å‘dpå€¼
 593           * @param[in] {value} dpæ•°æ®ç¼“å†²åŒºåœ°å€
 594           * @param[in] {len} dpæ•°æ®é•¿åº¦
 595           * @return å½“å‰dpå€¼
 596           * @note   Null
 597           */
 598          unsigned long mcu_get_dp_download_value(const unsigned char value[],unsigned short len)
 599          {
 600   1          return(byte_to_int(value));
 601   1      }
 602          
 603          /**
 604           * @brief  ä¸²å£æ¥æ”¶æ•°æ®æš‚å­˜å¤„ç†
 605           * @param[in] {value} ä¸²å£æ”¶åˆ°çš„1å­—èŠ‚æ•°æ®
 606           * @return Null
 607           * @note   åœ¨MCUä¸²å£å¤„ç†å‡½æ•°ä¸­è°ƒç”¨è¯¥å‡½æ•°,å¹¶å°†æ¥æ”¶åˆ°çš„æ•°æ®ä½œä¸ºå‚æ•°ä¼ å…¥
 608           */
C51 COMPILER V9.01   MCU_API                                                               01/30/2021 09:17:26 PAGE 11  

 609          void uart_receive_input(unsigned char value)
 610          {
 611   1          #error "è¯·åœ¨ä¸²å£æ¥æ”¶ä¸­æ–­ä¸­è°ƒç”¨uart_receive_input(value),ä¸²å£æ•°æ®ç”±MCU_SDKå¤„ç†,ç”¨æˆ·
             -è¯·å‹¿å†å¦è¡Œå¤„ç†,å®Œæˆååˆ é™¤è¯¥è¡Œ" 
*** ERROR C320 IN LINE 611 OF MCU_SDK\mcu_api.c: "è¯·åœ¨ä¸²å£æ¥æ”¶ä¸­æ–­ä¸­è°ƒç”¨uart_receive_input(value),ä¸²å£æ•°æ
             -®ç”±MCU_SDKå¤„ç†,ç”¨æˆ·è¯·å‹¿å†å¦è¡Œå¤„ç†,å®Œæˆååˆ é™¤è¯¥è¡Œ" 
 612   1          
 613   1          if(1 == rx_buf_out - rx_buf_in) {
 614   2              //ä¸²å£æ¥æ”¶ç¼“å­˜å·²æ»¡
 615   2          }else if((rx_buf_in > rx_buf_out) && ((rx_buf_in - rx_buf_out) >= sizeof(wifi_uart_rx_buf))) {
 616   2              //ä¸²å£æ¥æ”¶ç¼“å­˜å·²æ»¡
 617   2          }else {
 618   2              //ä¸²å£æ¥æ”¶ç¼“å­˜æœªæ»¡
 619   2              if(rx_buf_in >= (unsigned char *)(wifi_uart_rx_buf + sizeof(wifi_uart_rx_buf))) {
 620   3                  rx_buf_in = (unsigned char *)(wifi_uart_rx_buf);
 621   3              }
 622   2              
 623   2              *rx_buf_in ++ = value;
 624   2          }
 625   1      }
 626          
 627          /**
 628           * @brief  ä¸²å£æ¥æ”¶å¤šä¸ªå­—èŠ‚æ•°æ®æš‚å­˜å¤„ç†
 629           * @param[in] {value} ä¸²å£è¦æ¥æ”¶çš„æ•°æ®çš„æºåœ°å€
 630           * @param[in] {data_len} ä¸²å£è¦æ¥æ”¶çš„æ•°æ®çš„æ•°æ®é•¿åº¦
 631           * @return Null
 632           * @note   å¦‚éœ€è¦æ”¯æŒä¸€æ¬¡å¤šå­—èŠ‚ç¼“å­˜ï¼Œå¯è°ƒç”¨è¯¥å‡½æ•°
 633           */
 634          void uart_receive_buff_input(unsigned char value[], unsigned short data_len)
 635          {
 636   1          #error "è¯·åœ¨éœ€è¦ä¸€æ¬¡ç¼“å­˜å¤šä¸ªå­—èŠ‚ä¸²å£æ•°æ®å¤„è°ƒç”¨æ­¤å‡½æ•°,ä¸²å£æ•°æ®ç”±MCU_SDKå¤„ç
             -†,ç”¨æˆ·è¯·å‹¿å†å¦è¡Œå¤„ç†,å®Œæˆååˆ é™¤è¯¥è¡Œ" 
*** ERROR C320 IN LINE 636 OF MCU_SDK\mcu_api.c: "è¯·åœ¨éœ€è¦ä¸€æ¬¡ç¼“å­˜å¤šä¸ªå­—èŠ‚ä¸²å£æ•°æ®å¤„è°ƒç”¨æ­¤å‡½æ•°,ä¸²
             -å£æ•°æ®ç”±MCU_SDKå¤„ç†,ç”¨æˆ·è¯·å‹¿å†å¦è¡Œå¤„ç†,å®Œæˆååˆ é™¤è¯¥è¡Œ" 
 637   1          
 638   1          unsigned short i = 0;
 639   1          for(i = 0; i < data_len; i++) {
 640   2              uart_receive_input(value[i]);
 641   2          }
 642   1      }
 643          
 644          /**
 645           * @brief  wifiä¸²å£æ•°æ®å¤„ç†æœåŠ¡
 646           * @param  Null
 647           * @return Null
 648           * @note   åœ¨MCUä¸»å‡½æ•°whileå¾ªç¯ä¸­è°ƒç”¨è¯¥å‡½æ•°
 649           */
 650          void wifi_uart_service(void)
 651          {
 652   1          #error "è¯·ç›´æ¥åœ¨mainå‡½æ•°çš„while(1){}ä¸­æ·»åŠ wifi_uart_service(),è°ƒç”¨è¯¥å‡½æ•°ä¸è¦åŠ ä»»ä½•
             -æ¡ä»¶åˆ¤æ–­,å®Œæˆååˆ é™¤è¯¥è¡Œ" 
*** ERROR C320 IN LINE 652 OF MCU_SDK\mcu_api.c: "è¯·ç›´æ¥åœ¨mainå‡½æ•°çš„while(1){}ä¸­æ·»åŠ wifi_uart_service(),è°ƒç”¨
             -è¯¥å‡½æ•°ä¸è¦åŠ ä»»ä½•æ¡ä»¶åˆ¤æ–­,å®Œæˆååˆ é™¤è¯¥è¡Œ" 
 653   1          static unsigned short rx_in = 0;
 654   1          unsigned short offset = 0;
 655   1          unsigned short rx_value_len = 0;
 656   1          
 657   1          while((rx_in < sizeof(wifi_data_process_buf)) && with_data_rxbuff() > 0) {
 658   2              wifi_data_process_buf[rx_in ++] = take_byte_rxbuff();
 659   2          }
 660   1          
 661   1          if(rx_in < PROTOCOL_HEAD)
C51 COMPILER V9.01   MCU_API                                                               01/30/2021 09:17:26 PAGE 12  

 662   1              return;
 663   1          
 664   1          while((rx_in - offset) >= PROTOCOL_HEAD) {
 665   2              if(wifi_data_process_buf[offset + HEAD_FIRST] != FRAME_FIRST) {
 666   3                  offset ++;
 667   3                  continue;
 668   3              }
 669   2              
 670   2              if(wifi_data_process_buf[offset + HEAD_SECOND] != FRAME_SECOND) {
 671   3                  offset ++;
 672   3                  continue;
 673   3              }  
 674   2              
 675   2              if(wifi_data_process_buf[offset + PROTOCOL_VERSION] != MCU_RX_VER) {
 676   3                  offset += 2;
 677   3                  continue;
 678   3              }      
 679   2              
 680   2              rx_value_len = wifi_data_process_buf[offset + LENGTH_HIGH] * 0x100;
 681   2              rx_value_len += (wifi_data_process_buf[offset + LENGTH_LOW] + PROTOCOL_HEAD);
 682   2              if(rx_value_len > sizeof(wifi_data_process_buf) + PROTOCOL_HEAD) {
 683   3                  offset += 3;
 684   3                  continue;
 685   3              }
 686   2              
 687   2              if((rx_in - offset) < rx_value_len) {
 688   3                  break;
 689   3              }
 690   2              
 691   2              //æ•°æ®æ¥æ”¶å®Œæˆ
 692   2              if(get_check_sum((unsigned char *)wifi_data_process_buf + offset,rx_value_len - 1) != wifi_data_pr
             -ocess_buf[offset + rx_value_len - 1]) {
 693   3                  //æ ¡éªŒå‡ºé”™
 694   3                  //printf("crc error (crc:0x%X  but data:0x%X)\r\n",get_check_sum((unsigned char *)wifi_data_pr
             -ocess_buf + offset,rx_value_len - 1),wifi_data_process_buf[offset + rx_value_len - 1]);
 695   3                  offset += 3;
 696   3                  continue;
 697   3              }
 698   2              
 699   2              data_handle(offset);
 700   2              offset += rx_value_len;
 701   2          }//end while
 702   1      
 703   1          rx_in -= offset;
 704   1          if(rx_in > 0) {
 705   2              my_memcpy((char *)wifi_data_process_buf, (const char *)wifi_data_process_buf + offset, rx_in);
 706   2          }
 707   1      }
 708          
 709          /**
 710           * @brief  åè®®ä¸²å£åˆå§‹åŒ–å‡½æ•°
 711           * @param  Null
 712           * @return Null
 713           * @note   åœ¨MCUåˆå§‹åŒ–ä»£ç ä¸­è°ƒç”¨è¯¥å‡½æ•°
 714           */
 715          void wifi_protocol_init(void)
 716          {
 717   1          #error " è¯·åœ¨mainå‡½æ•°ä¸­æ·»åŠ wifi_protocol_init()å®Œæˆwifiåè®®åˆå§‹åŒ–,å¹¶åˆ é™¤è¯¥è¡Œ"
*** ERROR C320 IN LINE 717 OF MCU_SDK\mcu_api.c: " è¯·åœ¨mainå‡½æ•°ä¸­æ·»åŠ wifi_protocol_init()å®Œæˆwifiåè®®åˆå§‹åŒ
             -–,å¹¶åˆ é™¤è¯¥è¡Œ"
 718   1          rx_buf_in = (unsigned char *)wifi_uart_rx_buf;
 719   1          rx_buf_out = (unsigned char *)wifi_uart_rx_buf;
C51 COMPILER V9.01   MCU_API                                                               01/30/2021 09:17:26 PAGE 13  

 720   1          
 721   1          stop_update_flag = DISABLE;
 722   1          
 723   1      #ifndef WIFI_CONTROL_SELF_MODE
 724   1          wifi_work_state = WIFI_SATE_UNKNOW;
 725   1      #endif
 726   1      }
 727          
 728          
 729          
 730          #ifndef WIFI_CONTROL_SELF_MODE
 731          /**
 732           * @brief  MCUè·å–å¤ä½wifiæˆåŠŸæ ‡å¿—
 733           * @param  Null
 734           * @return å¤ä½æ ‡å¿—
 735           * -           0(RESET_WIFI_ERROR):å¤±è´¥
 736           * -           1(RESET_WIFI_SUCCESS):æˆåŠŸ
 737           * @note   1:MCUä¸»åŠ¨è°ƒç”¨mcu_reset_wifi()åè°ƒç”¨è¯¥å‡½æ•°è·å–å¤ä½çŠ¶æ€
 738           *         2:å¦‚æœä¸ºæ¨¡å—è‡ªå¤„ç†æ¨¡å¼,MCUæ— é¡»è°ƒç”¨è¯¥å‡½æ•°
 739           */
 740          unsigned char mcu_get_reset_wifi_flag(void)
 741          {
 742   1          return reset_wifi_flag;
 743   1      }
 744          
 745          /**
 746           * @brief  MCUä¸»åŠ¨é‡ç½®wifiå·¥ä½œæ¨¡å¼
 747           * @param  Null
 748           * @return Null
 749           * @note   1:MCUä¸»åŠ¨è°ƒç”¨,é€šè¿‡mcu_get_reset_wifi_flag()å‡½æ•°è·å–é‡ç½®wifiæ˜¯å¦æˆåŠŸ
 750           *         2:å¦‚æœä¸ºæ¨¡å—è‡ªå¤„ç†æ¨¡å¼,MCUæ— é¡»è°ƒç”¨è¯¥å‡½æ•°
 751           */
 752          void mcu_reset_wifi(void)
 753          {
 754   1          reset_wifi_flag = RESET_WIFI_ERROR;
 755   1          
 756   1          wifi_uart_write_frame(WIFI_RESET_CMD, MCU_TX_VER, 0);
 757   1      }
 758          
 759          /**
 760           * @brief  è·å–è®¾ç½®wifiçŠ¶æ€æˆåŠŸæ ‡å¿—
 761           * @param  Null
 762           * @return wifimode flag
 763           * -           0(SET_WIFICONFIG_ERROR):å¤±è´¥
 764           * -           1(SET_WIFICONFIG_SUCCESS):æˆåŠŸ
 765           * @note   1:MCUä¸»åŠ¨è°ƒç”¨mcu_set_wifi_mode()åè°ƒç”¨è¯¥å‡½æ•°è·å–å¤ä½çŠ¶æ€
 766           *         2:å¦‚æœä¸ºæ¨¡å—è‡ªå¤„ç†æ¨¡å¼,MCUæ— é¡»è°ƒç”¨è¯¥å‡½æ•°
 767           */
 768          unsigned char mcu_get_wifimode_flag(void)
 769          {
 770   1          return set_wifimode_flag;
 771   1      }
 772          
 773          /**
 774           * @brief  MCUè®¾ç½®wifiå·¥ä½œæ¨¡å¼
 775           * @param[in] {mode} è¿›å…¥çš„æ¨¡å¼
 776           * @ref        0(SMART_CONFIG):è¿›å…¥smartconfigæ¨¡å¼
 777           * @ref        1(AP_CONFIG):è¿›å…¥APæ¨¡å¼
 778           * @return Null
 779           * @note   1:MCUä¸»åŠ¨è°ƒç”¨
 780           *         2:æˆåŠŸå,å¯åˆ¤æ–­set_wifi_config_stateæ˜¯å¦ä¸ºTRUE;TRUEè¡¨ç¤ºä¸ºè®¾ç½®wifiå·¥ä½œæ¨¡å¼æˆå
             -ŠŸ
C51 COMPILER V9.01   MCU_API                                                               01/30/2021 09:17:26 PAGE 14  

 781           *         3:å¦‚æœä¸ºæ¨¡å—è‡ªå¤„ç†æ¨¡å¼,MCUæ— é¡»è°ƒç”¨è¯¥å‡½æ•°
 782           */
 783          void mcu_set_wifi_mode(unsigned char mode)
 784          {
 785   1          unsigned char length = 0;
 786   1          
 787   1          set_wifimode_flag = SET_WIFICONFIG_ERROR;
 788   1          
 789   1          length = set_wifi_uart_byte(length, mode);
 790   1          
 791   1          wifi_uart_write_frame(WIFI_MODE_CMD, MCU_TX_VER, length);
 792   1      }
 793          
 794          /**
 795           * @brief  MCUä¸»åŠ¨è·å–å½“å‰wifiå·¥ä½œçŠ¶æ€
 796           * @param  Null
 797           * @return wifi work state
 798           * -          SMART_CONFIG_STATE: smartconfigé…ç½®çŠ¶æ€
 799           * -          AP_STATE: APé…ç½®çŠ¶æ€
 800           * -          WIFI_NOT_CONNECTED: WIFIé…ç½®æˆåŠŸä½†æœªè¿ä¸Šè·¯ç”±å™¨
 801           * -          WIFI_CONNECTED: WIFIé…ç½®æˆåŠŸä¸”è¿ä¸Šè·¯ç”±å™¨
 802           * -          WIFI_CONN_CLOUD: WIFIå·²ç»è¿æ¥ä¸Šäº‘æœåŠ¡å™¨
 803           * -          WIFI_LOW_POWER: WIFIå¤„äºä½åŠŸè€—æ¨¡å¼
 804           * -          SMART_AND_AP_STATE: WIFI smartconfig&AP æ¨¡å¼
 805           * @note   å¦‚æœä¸ºæ¨¡å—è‡ªå¤„ç†æ¨¡å¼,MCUæ— é¡»è°ƒç”¨è¯¥å‡½æ•°
 806           */
 807          unsigned char mcu_get_wifi_work_state(void)
 808          {
 809   1          return wifi_work_state;
 810   1      }
 811          #endif
 812          
 813          #ifdef SUPPORT_GREEN_TIME
              /**
               * @brief  MCUè·å–æ ¼æ—æ—¶é—´
               * @param  Null
               * @return Null
               * @note   MCUéœ€è¦è‡ªè¡Œè°ƒç”¨è¯¥åŠŸèƒ½
               */
              void mcu_get_green_time(void)
              {
                  wifi_uart_write_frame(GET_ONLINE_TIME_CMD, MCU_TX_VER, 0);
              }
              #endif
 825          
 826          #ifdef SUPPORT_MCU_RTC_CHECK
              /**
               * @brief  MCUè·å–ç³»ç»Ÿæ—¶é—´,ç”¨äºæ ¡å¯¹æœ¬åœ°æ—¶é’Ÿ
               * @param  Null
               * @return Null
               * @note   MCUä¸»åŠ¨è°ƒç”¨å®Œæˆååœ¨mcu_write_rtctimeå‡½æ•°å†…æ ¡å¯¹rtcæ—¶é’Ÿ
               */
              void mcu_get_system_time(void)
              {
                  wifi_uart_write_frame(GET_LOCAL_TIME_CMD, MCU_TX_VER, 0);
              }
              #endif
 838          
 839          #ifdef WIFI_TEST_ENABLE
 840          /**
 841           * @brief  mcuå‘èµ·wifiåŠŸèƒ½æµ‹è¯•
 842           * @param  Null
C51 COMPILER V9.01   MCU_API                                                               01/30/2021 09:17:26 PAGE 15  

 843           * @return Null
 844           * @note   MCUéœ€è¦è‡ªè¡Œè°ƒç”¨è¯¥åŠŸèƒ½
 845           */
 846          void mcu_start_wifitest(void)
 847          {
 848   1          wifi_uart_write_frame(WIFI_TEST_CMD, MCU_TX_VER, 0);
 849   1      }
 850          #endif
 851          
 852          #ifdef WIFI_HEARTSTOP_ENABLE
              /**
               * @brief  é€šçŸ¥WIFIæ¨¡ç»„å…³é—­å¿ƒè·³
               * @param  Null
               * @return Null
               * @note   MCUéœ€è¦è‡ªè¡Œè°ƒç”¨è¯¥åŠŸèƒ½
               */
              void wifi_heart_stop(void)
              {
                  wifi_uart_write_frame(HEAT_BEAT_STOP, MCU_TX_VER, 0);
              }
              #endif
 864          
 865          #ifdef GET_WIFI_STATUS_ENABLE
              /**
               * @brief  è·å–å½“å‰wifiè”ç½‘çŠ¶æ€
               * @param  Null
               * @return Null
               * @note   MCUéœ€è¦è‡ªè¡Œè°ƒç”¨è¯¥åŠŸèƒ½
               */
              void mcu_get_wifi_connect_status(void)
              {
                  wifi_uart_write_frame(GET_WIFI_STATUS_CMD, MCU_TX_VER, 0);
              }
              #endif
 877          
 878          #ifdef WIFI_STREAM_ENABLE
              /**
               * @brief  æµæœåŠ¡å‘é€
               * @param[in] {id} IDå·
               * @param[in] {buffer} å‘é€åŒ…çš„åœ°å€
               * @param[in] {buf_len} å‘é€åŒ…é•¿åº¦
               * @return æµæœåŠ¡ä¼ è¾“ç»“æœ
               * -           0(ERROR): å¤±è´¥
               * -           1(SUCCESS): æˆåŠŸ
               * @note   MCUéœ€è¦è‡ªè¡Œå®ç°è¯¥åŠŸèƒ½
               */
              unsigned char stream_trans_send(unsigned int id, unsigned char *buffer, unsigned long buf_len)
              {
                  unsigned long map_offset = 0;
                  unsigned int pack_num = 0;
                  unsigned int rest_length = 0;
              
                  if(stop_update_flag == ENABLE)
                      return ERROR;
              
                  pack_num = buf_len / STREM_PACK_LEN;
                  rest_length = buf_len - pack_num * STREM_PACK_LEN;
                  if (rest_length > 0) {
                      pack_num++;
                  }
              
                  int this_len = STREM_PACK_LEN;
C51 COMPILER V9.01   MCU_API                                                               01/30/2021 09:17:26 PAGE 16  

                  for (int cnt = 0; cnt < pack_num; cnt++,map_offset += this_len) {
                      if (cnt == pack_num - 1 && rest_length > 0) {
                          this_len = rest_length;
                      }else {
                          this_len = STREM_PACK_LEN;
                      }
              
                      if(ERROR == stream_trans(id, map_offset, buffer + map_offset, this_len)) {
                          //mcuæ­£åœ¨å‡çº§ä¸­ï¼Œä¸å¯ä»¥è¿›è¡ŒæµæœåŠ¡ä¼ è¾“
                          //printf("is upgrade\n");
                          return ERROR;
                      }
                      
                      #error "è¯·æ ¹æ®æç¤ºï¼Œè‡ªè¡Œå®Œå–„æµæœåŠ¡å‘é€ä»£ç ï¼Œå®Œæˆåè¯·åˆ é™¤è¯¥è¡Œ"
                      /*  å¦‚æœMCUå¯ä»¥ä½¿ç”¨å¤šè¿›ç¨‹æˆ–å¤šçº¿ç¨‹ï¼Œå¯ä»¥å°†æ­¤å‡½æ•°æ”¾åœ¨ä¸€ä¸ªå•ç‹¬çš„è¿›ç¨‹æˆ–ç
             -º¿ç¨‹é‡Œæ‰§è¡Œï¼Œå¹¶æ‰“å¼€ä¸‹é¢æ‰€ç¤ºçš„ä»£ç   */
                      /*
                      while(0xff == stream_status); //ç­‰å¾…æ¨¡å—å›å¤
                      
                      if(0x00 != stream_status) {
                          //å¤±è´¥  å¯åœ¨ stream_trans_send_result å‡½æ•°ä¸­æŸ¥çœ‹é”™è¯¯ç 
                          return ERROR;
                      }
                      */
                      
                      /*  å¦‚æœMCUä¸æ”¯æŒå¤šè¿›ç¨‹æˆ–å¤šçº¿ç¨‹ï¼Œä½¿ç”¨æ­¤å‡½æ•°æ—¶æ¯æ¬¡åªå‘ä¸€åŒ…ï¼ˆæ•°æ®é•¿åº¦ä
             -¸å¤§äºSTREM_PACK_LENï¼‰ï¼Œ
                      å‘é€å®Œä¹‹ååœ¨ stream_trans_send_result å‡½æ•°ä¸­å¤„ç†æ¨¡å—è¿”å›çš„ç»“æœï¼Œå‘é€æˆåŠŸæ—¶
             -å†æ¬¡è°ƒç”¨æ­¤å‡½æ•°å‘é€ä¸‹ä¸€åŒ…ï¼Œæ³¨æ„åŒ…åç§»è¦å¢åŠ   */
                  }
                  
                  return SUCCESS;
              }
              
              /**
               * @brief  å¤šåœ°å›¾æµæœåŠ¡å‘é€
               * @param[in] {id} åœ°å›¾æµæœåŠ¡ä¼šè¯ID
               * @param[in] {sub_id} å­åœ°å›¾ID
               * @param[in] {sub_id_pro_mode} å­åœ°å›¾IDæ•°æ®å¤„ç†æ–¹å¼
               * @ref       0x00: ç»§ç»­ç´¯åŠ 
               * @ref       0x01: æ¸…é™¤ä¸Šä¼ çš„æ•°æ®
               * @param[in] {buffer} æ•°æ®åŒ…å‘é€çš„åœ°å€
               * @param[in] {buf_len} æ•°æ®åŒ…å‘é€çš„é•¿åº¦
               * @return æµæœåŠ¡ä¼ è¾“ç»“æœ
               * -           0(ERROR): å¤±è´¥
               * -           1(SUCCESS): æˆåŠŸ
               * @note   MCUéœ€è¦è‡ªè¡Œå®ç°è¯¥åŠŸèƒ½
               */
              unsigned char maps_stream_trans_send(unsigned int id, unsigned char sub_id, unsigned char sub_id_pro_mode,
             - unsigned char *buffer, unsigned long buf_len)
              {
                  unsigned long map_offset = 0;
                  unsigned int pack_num = 0;
                  unsigned int rest_length = 0;
                  unsigned char pro_ver = 0; //åœ°å›¾æœåŠ¡åè®®ç‰ˆæœ¬ é»˜è®¤ä¸º0
              
                  if(stop_update_flag == ENABLE)
                      return SUCCESS;
              
                  pack_num = buf_len / STREM_PACK_LEN;
                  rest_length = buf_len - pack_num * STREM_PACK_LEN;
                  if (rest_length > 0) {
C51 COMPILER V9.01   MCU_API                                                               01/30/2021 09:17:26 PAGE 17  

                      pack_num++;
                  }
              
                  int this_len = STREM_PACK_LEN;
                  for (int cnt = 0; cnt < pack_num; cnt++,map_offset += this_len) {
                      if (cnt == pack_num - 1 && rest_length > 0) {
                          this_len = rest_length;
                      }else {
                          this_len = STREM_PACK_LEN;
                      }
              
                      if(ERROR == maps_stream_trans(pro_ver, id, sub_id, sub_id_pro_mode, map_offset, buffer + map_offse
             -t, this_len)) {
                          //mcuæ­£åœ¨å‡çº§ä¸­ï¼Œä¸å¯ä»¥è¿›è¡ŒæµæœåŠ¡ä¼ è¾“
                          //printf("is upgrade\n");
                          return ERROR;
                      }
                      
                      #error "è¯·æ ¹æ®æç¤ºï¼Œè‡ªè¡Œå®Œå–„æµæœåŠ¡å‘é€ä»£ç ï¼Œå®Œæˆåè¯·åˆ é™¤è¯¥è¡Œ"
                      /*  å¦‚æœMCUå¯ä»¥ä½¿ç”¨å¤šè¿›ç¨‹æˆ–å¤šçº¿ç¨‹ï¼Œå¯ä»¥å°†æ­¤å‡½æ•°æ”¾åœ¨ä¸€ä¸ªå•ç‹¬çš„è¿›ç¨‹æˆ–ç
             -º¿ç¨‹é‡Œæ‰§è¡Œï¼Œå¹¶æ‰“å¼€ä¸‹é¢æ‰€ç¤ºçš„ä»£ç   */
                      /*
                      while(0xff == maps_stream_status); //ç­‰å¾…æ¨¡å—å›å¤
                      
                      if(0x00 != maps_stream_status) {
                          //å¤±è´¥  å¯åœ¨ maps_stream_trans_send_result å‡½æ•°ä¸­æŸ¥çœ‹é”™è¯¯ç 
                          return ERROR;
                      }
                      */
                      
                      /*  å¦‚æœMCUä¸æ”¯æŒå¤šè¿›ç¨‹æˆ–å¤šçº¿ç¨‹ï¼Œä½¿ç”¨æ­¤å‡½æ•°æ—¶æ¯æ¬¡åªå‘ä¸€åŒ…ï¼ˆæ•°æ®é•¿åº¦ä
             -¸å¤§äºSTREM_PACK_LENï¼‰ï¼Œ
                      å‘é€å®Œä¹‹ååœ¨ maps_stream_trans_send_result å‡½æ•°ä¸­å¤„ç†æ¨¡å—è¿”å›çš„ç»“æœï¼Œå‘é€æˆå
             -ŠŸæ—¶å†æ¬¡è°ƒç”¨æ­¤å‡½æ•°å‘é€ä¸‹ä¸€åŒ…ï¼Œæ³¨æ„åŒ…åç§»è¦å¢åŠ   */
                  }
                  
                  return SUCCESS;
              }
              #endif
 998          
 999          #ifdef WIFI_CONNECT_TEST_ENABLE
              /**
               * @brief  mcuå‘èµ·wifiåŠŸèƒ½æµ‹è¯•(è¿æ¥æŒ‡å®šè·¯ç”±)
               * @param[in] {ssid_buf} å­˜æ”¾è·¯ç”±å™¨åç§°å­—ç¬¦ä¸²æ•°æ®çš„åœ°å€(ssidé•¿åº¦æœ€å¤§æ”¯æŒ32ä¸ªå­—èŠ‚)
               * @param[in] {passwd_buffer} å­˜æ”¾è·¯ç”±å™¨åç§°å­—ç¬¦ä¸²æ•°æ®çš„åœ°å€(passwdé•¿åº¦æœ€å¤§æ”¯æŒ64ä¸ªå
             -­—èŠ‚)
               * @return Null
               * @note   MCUéœ€è¦è‡ªè¡Œè°ƒç”¨è¯¥åŠŸèƒ½
               */
              void mcu_start_connect_wifitest(unsigned char *ssid_buf,unsigned char *passwd_buffer)
              {
                  unsigned short send_len = 0;
              
                  if( my_strlen(ssid_buf) > 32 || my_strlen(passwd_buffer) > 64) {
                      //printf("ssid_buf or passwd_buffer is too long!");
                      return;
                  }
                  
                  send_len = set_wifi_uart_buffer(send_len, "{\"ssid\":\"", my_strlen("{\"ssid\":\""));
                  send_len = set_wifi_uart_buffer(send_len,ssid_buf,my_strlen(ssid_buf));
                  send_len = set_wifi_uart_buffer(send_len, "\",\"password\":\"", my_strlen("\",\"password\":\""));
                  send_len = set_wifi_uart_buffer(send_len,passwd_buffer,my_strlen(passwd_buffer));
C51 COMPILER V9.01   MCU_API                                                               01/30/2021 09:17:26 PAGE 18  

                  send_len = set_wifi_uart_buffer(send_len, "\"}", my_strlen("\"}"));
              
                  wifi_uart_write_frame(WIFI_CONNECT_TEST_CMD, MCU_TX_VER, send_len);
              }
              #endif
1025          
1026          #ifdef GET_MODULE_MAC_ENABLE
              /**
               * @brief  è·å–æ¨¡å—MAC
               * @param  Null
               * @return Null
               * @note   MCUéœ€è¦è‡ªè¡Œè°ƒç”¨è¯¥åŠŸèƒ½
               */
              void mcu_get_module_mac(void)
              {
                  wifi_uart_write_frame(GET_MAC_CMD, MCU_TX_VER, 0);
              }
              #endif
1038          
1039          #ifdef IR_TX_RX_TEST_ENABLE
              /**
               * @brief  mcuå‘èµ·çº¢å¤–è¿›å…¥æ”¶å‘äº§æµ‹
               * @param  Null
               * @return Null
               * @note   MCUéœ€è¦è‡ªè¡Œè°ƒç”¨è¯¥åŠŸèƒ½
               */
              void mcu_start_ir_test(void)
              {
                  wifi_uart_write_frame(IR_TX_RX_TEST_CMD, MCU_TX_VER, 0);
              }
              #endif
1051          
1052          #ifdef MODULE_EXPANDING_SERVICE_ENABLE
              /**
               * @brief  æ‰“å¼€æ¨¡å—æ—¶é—´æœåŠ¡é€šçŸ¥
               * @param[in] {time_type} æ—¶é—´ç±»å‹
               * @ref       0x00: æ ¼æ—æ—¶é—´
               * @ref       0x01: æœ¬åœ°æ—¶é—´
               * @return Null
               * @note   MCUéœ€è¦è‡ªè¡Œè°ƒç”¨è¯¥åŠŸèƒ½
               */
              void open_module_time_serve(unsigned char time_type)
              {
                  unsigned short send_len = 0;
                  send_len = set_wifi_uart_byte(send_len, 0x01);
                  send_len = set_wifi_uart_byte(send_len, time_type);
                  wifi_uart_write_frame(MODULE_EXTEND_FUN_CMD, MCU_TX_VER, send_len);
              }
              
              /**
               * @brief  ä¸»åŠ¨è¯·æ±‚å¤©æ°”æœåŠ¡æ•°æ®
               * @param  Null
               * @return Null
               * @note   MCUéœ€è¦è‡ªè¡Œè°ƒç”¨è¯¥åŠŸèƒ½
               */
              void request_weather_serve(void)
              {
                  unsigned short send_len = 0;
                  send_len = set_wifi_uart_byte(send_len, 0x03);
                  wifi_uart_write_frame(MODULE_EXTEND_FUN_CMD, MCU_TX_VER, send_len);
              }
              
C51 COMPILER V9.01   MCU_API                                                               01/30/2021 09:17:26 PAGE 19  

              /**
               * @brief  æ‰“å¼€æ¨¡å—é‡ç½®çŠ¶æ€é€šçŸ¥
               * @param  Null
               * @return Null
               * @note   MCUéœ€è¦è‡ªè¡Œè°ƒç”¨è¯¥åŠŸèƒ½
               */
              void open_module_reset_state_serve(void)
              {
                  unsigned short send_len = 0;
                  send_len = set_wifi_uart_byte(send_len, 0x04);
                  wifi_uart_write_frame(MODULE_EXTEND_FUN_CMD, MCU_TX_VER, send_len);
              }
              #endif
1095          
1096          #ifdef BLE_RELATED_FUNCTION_ENABLE
              /**
               * @brief  mcuå‘èµ·è“ç‰™åŠŸèƒ½æ€§æµ‹è¯•ï¼ˆæ‰«ææŒ‡å®šè“ç‰™ä¿¡æ ‡ï¼‰
               * @param  Null
               * @return Null
               * @note   MCUéœ€è¦è‡ªè¡Œè°ƒç”¨è¯¥åŠŸèƒ½
               */
              void mcu_start_BLE_test(void)
              {
                  unsigned short send_len = 0;
                  send_len = set_wifi_uart_byte(send_len, 0x01);
                  wifi_uart_write_frame(BLE_TEST_CMD, MCU_TX_VER, send_len);
              }
              #endif
1110          
1111          #ifdef VOICE_MODULE_PROTOCOL_ENABLE
              /**
               * @brief  è·å–è¯­éŸ³çŠ¶æ€ç 
               * @param  Null
               * @return Null
               * @note   MCUéœ€è¦è‡ªè¡Œè°ƒç”¨è¯¥åŠŸèƒ½
               */
              void get_voice_state(void)
              {
                  wifi_uart_write_frame(GET_VOICE_STATE_CMD, MCU_TX_VER, 0);
              }
              
              /**
               * @brief  MICé™éŸ³è®¾ç½®
               * @param[in] {set_val} é™éŸ³è®¾ç½®å€¼
               * @ref       0x00: micå¼€å¯
               * @ref       0x01: micé™éŸ³
               * @ref       0xA0: æŸ¥è¯¢é™éŸ³çŠ¶æ€
               * @return Null
               * @note   MCUéœ€è¦è‡ªè¡Œè°ƒç”¨è¯¥åŠŸèƒ½
               */
              void set_voice_MIC_silence(unsigned char set_val)
              {
                  unsigned short send_len = 0;
                  send_len = set_wifi_uart_byte(send_len, set_val);
                  wifi_uart_write_frame(MIC_SILENCE_CMD, MCU_TX_VER, send_len);
              }
              
              /**
               * @brief  speakeréŸ³é‡è®¾ç½®
               * @param[in] {set_val} éŸ³é‡è®¾ç½®å€¼
               * @ref       0~10: éŸ³é‡èŒƒå›´
               * @ref       0xA0: æŸ¥è¯¢éŸ³é‡å€¼
C51 COMPILER V9.01   MCU_API                                                               01/30/2021 09:17:26 PAGE 20  

               * @return Null
               * @note   MCUéœ€è¦è‡ªè¡Œè°ƒç”¨è¯¥åŠŸèƒ½
               */
              void set_speaker_voice(unsigned char set_val)
              {
                  unsigned short send_len = 0;
                  send_len = set_wifi_uart_byte(send_len, set_val);
                  wifi_uart_write_frame(SET_SPEAKER_VOLUME_CMD, MCU_TX_VER, send_len);
              }
              
              /**
               * @brief  éŸ³é¢‘äº§æµ‹
               * @param[in] {set_val} éŸ³é¢‘äº§æµ‹å€¼
               * @ref       0x00: å…³é—­éŸ³é¢‘äº§æµ‹
               * @ref       0x01: mic1éŸ³é¢‘ç¯è·¯æµ‹è¯•
               * @ref       0x02: mic2éŸ³é¢‘ç¯è·¯æµ‹è¯•
               * @ref       0xA0: æŸ¥è¯¢å½“å‰äº§æµ‹çŠ¶æ€
               * @return Null
               * @note   MCUéœ€è¦è‡ªè¡Œè°ƒç”¨è¯¥åŠŸèƒ½
               */
              void voice_test(unsigned char test_val)
              {
                  unsigned short send_len = 0;
                  send_len = set_wifi_uart_byte(send_len, test_val);
                  wifi_uart_write_frame(VOICE_TEST_CMD, MCU_TX_VER, send_len);
              }
              
              /**
               * @brief  å”¤é†’äº§æµ‹
               * @param  Null
               * @return Null
               * @note   MCUéœ€è¦è‡ªè¡Œè°ƒç”¨è¯¥åŠŸèƒ½
               */
              void voice_awaken_test(void)
              {
                  wifi_uart_write_frame(VOICE_AWAKEN_TEST_CMD, MCU_TX_VER, 0);
              }
              
              /**
               * @brief  è¯­éŸ³æ¨¡ç»„MCUåŠŸèƒ½è®¾ç½®
               * @param[in] {play} æ’­æ”¾/æš‚åœåŠŸèƒ½ 1(æ’­æ”¾) / 0(æš‚åœ)
               * @param[in] {bt_play} è“ç‰™å¼€å…³åŠŸèƒ½ 1(å¼€) / 0(å…³)
               * @return Null
               * @note   MCUéœ€è¦è‡ªè¡Œè°ƒç”¨è¯¥åŠŸèƒ½
               */
              void voice_mcu_fun_set(unsigned char play, unsigned char bt_play)
              {
                  unsigned short send_len = 0;
                  unsigned char str[50];
                  
                  //MCUè®¾ç½®æš‚ä»…æ”¯æŒâ€æ’­æ”¾/æš‚åœâ€ â€è“ç‰™å¼€å…³â€
                  
                  sprintf((char*)str,"{\"play\":%s,\"bt_play\":%s}", play?"true":"false", bt_play?"true":"false");
                  
                  send_len = set_wifi_uart_byte(send_len, 0x00);
                  send_len = set_wifi_uart_buffer(send_len, str, my_strlen(str));
                  wifi_uart_write_frame(VOICE_EXTEND_FUN_CMD, MCU_TX_VER, send_len);
              }
              #endif
1203          
1204          

C51 COMPILATION COMPLETE.  0 WARNING(S),  7 ERROR(S)
